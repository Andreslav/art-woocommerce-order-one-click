jQuery(function(b){if(typeof awooc_scripts_ajax==="undefined"){console.warn("awooc_scripts_ajax not found");return false}if(typeof awooc_scripts_translate==="undefined"){console.warn("awooc_scripts_translate not found");return false}if(typeof awooc_scripts_settings==="undefined"){console.warn("awooc_scripts_settings not found");return false}if(typeof wpcf7==="undefined"||wpcf7===null){console.warn("На странице не существует объекта wpcf7. Что-то не так с темой...");return false}const a={xhr:false,$button:b(".awooc-button-js"),analyticData:{},init:function(){b(document.body).on("click",".awooc-button-js",this.popup).on("awooc_popup_ajax_trigger",this.removeSkeleton).on("click",".awooc-close, .blockOverlay",this.unBlock).on("hide_variation",this.disableButton).on("show_variation",this.enableButton).on("wpcf7mailsent",this.sendSuccess).on("wpcf7invalid",this.sendInvalid)},disableButton:function(){a.$button.addClass("disabled wc-variation-selection-needed")},enableButton:function(d,c){if(false!==c.is_in_stock){a.$button.removeClass("disabled wc-variation-selection-needed")}else{a.$button.addClass("disabled wc-variation-is-unavailable")}if(awooc_scripts_settings.mode==="no_stock_no_price"){if(false===c.is_purchasable||false===c.is_in_stock){a.$button.removeClass("disabled wc-variation-selection-needed");b("body.woocommerce").find(".single_variation").hide();b("body.woocommerce").find(".quantity").hide();b("body.woocommerce").find(".woocommerce-variation-add-to-cart .single_add_to_cart_button").hide()}}},getProductID:function(d){const c=b(".variations_form").find('input[name="variation_id"]').val();let selectedProductId=b(d.target).attr("data-value-product-id");if(0!==c&&typeof c!=="undefined"){selectedProductId=c}return selectedProductId},getQty:function(){return b(".quantity").find('input[name="quantity"]').val()||1},unBlock:function(){b.unblockUI()},removeSkeleton:function(){b(".awooc-popup-inner").find(".awooc-popup-item").each(function(c,d){b(d).removeClass("skeleton-loader")})},addedToMailData:function(d){const c=d.data.toMail;const e=Object.keys(c);let dataToMail="\n"+awooc_scripts_translate.product_data_title+"\n———\n";e.forEach(function(f){dataToMail+=c[f]+"\n"});return dataToMail},addedToPopupData:function(c){const e=c.data.toPopup;const d=Object.keys(e);d.forEach(function(f){b(".awooc-popup-"+f).html(e[f])})},sendSuccess:function(c){setTimeout(a.unBlock,awooc_scripts_settings.popup.mailsent_timeout);b(document.body).trigger("awooc_mail_sent_trigger",{selectedProduct:a.analyticData,mailDetail:c})},sendInvalid:function(d,c){b(document.body).trigger("awooc_mail_invalid_trigger",[d,c]);setTimeout(function(){b(".awooc-form-custom-order .wpcf7-response-output").empty();b(".awooc-form-custom-order .wpcf7-not-valid-tip").remove()},awooc_scripts_settings.popup.invalid_timeout)},initMask:function(){const c=b(".awooc-form-custom-order .wpcf7-mask");if(c.length>0){c.each(function(){let $this=b(this),data_mask=$this.data("mask");try{$this.mask(data_mask);if(data_mask.indexOf("*")===-1&&data_mask.indexOf("a")===-1){$this.attr({inputmode:"numeric"})}}catch(d){console.error("Error "+d.name+":"+d.message+"\n"+d.stack)}})}},request:function(c){let data={id:a.getProductID(c),qty:a.getQty(c),action:"awooc_ajax_product_form",nonce:awooc_scripts_ajax.nonce};a.xhr=b.ajax({url:awooc_scripts_ajax.url,data:data,type:"POST",dataType:"json",success:function(d){a.addedToPopupData(d);a.analyticData=d.data.toAnalytics;a.initContactForm();a.initMask();b("textarea.awooc-hidden-data").val(a.addedToMailData(d));b(".awooc-hidden-product-id").val(a.getProductID(c));b(".awooc-hidden-product-qty").val(a.getQty(c));b(document.body).trigger("awooc_popup_ajax_trigger",d)},error:function(d){if(d.responseJSON){console.error(d.responseJSON.data)}}})},initContactForm:function(){b(".awooc-form-custom-order div.wpcf7 > form").each(function(){let version=b(this).find('input[name="_wpcf7_version"]').val();if((typeof version!=="undefined"&&version!==null)&&version<="5.4"){let $form=b(this);wpcf7.initForm($form);if(wpcf7.cached){wpcf7.refill($form)}}else{wpcf7.init(this)}})},popup:function(c){if(b(this).is(".disabled")){c.preventDefault();if(b(this).is(".wc-variation-is-unavailable")){window.alert(wc_add_to_cart_variation_params.i18n_unavailable_text)}else{if(b(this).is(".wc-variation-selection-needed")){window.alert(wc_add_to_cart_variation_params.i18n_make_a_selection_text)}}return false}b.blockUI({message:awooc_scripts_settings.template,css:awooc_scripts_settings.popup.css,overlayCSS:awooc_scripts_settings.popup.overlay,fadeIn:awooc_scripts_settings.popup.fadeIn,fadeOut:awooc_scripts_settings.popup.fadeOut,focusInput:awooc_scripts_settings.popup.focusInput,bindEvents:false,timeout:0,allowBodyStretch:true,centerX:true,centerY:true,blockMsgClass:"blockMsg blockMsgAwooc",onBlock:function(){b(document.body).trigger("awooc_popup_open_trigger");a.request(c)},onUnblock:function(){b(document.body).trigger("awooc_popup_close_trigger")},onOverlayClick:function(){b("html").css({overflow:"initial"})}})}};a.init()});