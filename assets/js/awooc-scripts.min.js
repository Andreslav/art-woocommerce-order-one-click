/*! For license information please see awooc-scripts.min.js.LICENSE.txt */
jQuery((function(o){"use strict";if("undefined"==typeof awooc_scripts_ajax)return console.warn("awooc_scripts_ajax not found"),!1;if("undefined"==typeof awooc_scripts_translate)return console.warn("awooc_scripts_translate not found"),!1;if("undefined"==typeof awooc_scripts_settings)return console.warn("awooc_scripts_settings not found"),!1;if("undefined"==typeof wpcf7||null===wpcf7)return console.warn("На странице не существует объекта wpcf7. Что-то не так с темой..."),!1;var t={xhr:!1,$button:o(".awooc-button-js"),formId:Number(awooc_scripts_settings.popup.cf7_form_id),analyticData:{},init:function(){o(document.body).on("click",".awooc-button-js",this.popup).on("awooc_popup_ajax_trigger",this.removeSkeleton).on("click",".awooc-close, .blockOverlay",this.unBlock).on("wc_variation_form",this.wc_variation_form).on("hide_variation",this.disableButton).on("show_variation",this.enableButton).on("wpcf7mailsent",this.sendSuccess).on("wpcf7invalid",this.sendInvalid)},wc_variation_form:function(o){console.log(o),awooc_scripts_settings.mode},disableButton:function(){t.$button.addClass("disabled wc-variation-selection-needed")},enableButton:function(o,a,e){switch(a.is_in_stock?t.$button.removeClass("disabled wc-variation-selection-needed"):t.$button.addClass("disabled wc-variation-is-unavailable"),"dont_show_add_to_card"===awooc_scripts_settings.mode&&t.$button.removeClass("disabled wc-variation-selection-needed"),awooc_scripts_settings.mode){case"dont_show_add_to_card":case"show_add_to_card":console.log(a);break;case"in_stock_add_to_card":a.backorders_allowed||!a.is_in_stock?(t.$button.removeClass("disabled wc-variation-selection-needed"),t.hideAddToCartModule(),t.showAwoocButton()):(t.showAddToCartModule(),t.hideAwoocButton());break;case"no_stock_no_price":console.log(e),console.log(a),console.log(a.is_in_stock),e?(console.log("showAddToCartModule max_qty"),t.showAddToCartModule()):(console.log("hideAddToCartModule max_qty"),t.$button.removeClass("disabled wc-variation-selection-needed"),t.hideAddToCartModule())}},hideAddToCartModule:function(){o("body.woocommerce").find(".woocommerce-variation-add-to-cart .quantity").addClass("awooc-hide"),o("body.woocommerce").find(".woocommerce-variation-add-to-cart .single_add_to_cart_button").addClass("awooc-hide")},showAddToCartModule:function(){o("body.woocommerce").find(".woocommerce-variation-add-to-cart .quantity").removeClass("awooc-hide"),o("body.woocommerce").find(".woocommerce-variation-add-to-cart .single_add_to_cart_button").removeClass("awooc-hide")},hideAwoocButton:function(o){t.$button.addClass("awooc-hide")},showAwoocButton:function(o){t.$button.removeClass("awooc-hide")},getProductID:function(t){var a=o(".variations_form").find('input[name="variation_id"]').val(),e=o(t.target).attr("data-value-product-id");return 0!==a&&void 0!==a&&(e=a),e},getQty:function(){return o(".quantity").find('input[name="quantity"]').val()||1},unBlock:function(){o.unblockUI()},removeSkeleton:function(){o(".awooc-popup-inner").find(".awooc-popup-item").each((function(t,a){o(a).removeClass("skeleton-loader")}))},addedToMailData:function(o){var t=o.data.toMail,a=Object.keys(t),e="\n"+awooc_scripts_translate.product_data_title+"\n———\n";return a.forEach((function(o){e+=t[o]+"\n"})),e},addedToPopupData:function(t){var a=t.data.toPopup;Object.keys(a).forEach((function(t){o(".awooc-popup-"+t).html(a[t])}))},sendSuccess:function(a){setTimeout(t.unBlock,awooc_scripts_settings.popup.mailsent_timeout),t.formId===a.detail.contactFormId&&o(document.body).trigger("awooc_mail_sent_trigger",{selectedProduct:t.analyticData,mailDetail:a.detail})},sendInvalid:function(a,e){t.formId===a.detail.contactFormId&&o(document.body).trigger("awooc_mail_invalid_trigger",[a,e]),setTimeout((function(){o(".awooc-form-custom-order .wpcf7-response-output").empty(),o(".awooc-form-custom-order .wpcf7-not-valid-tip").remove()}),awooc_scripts_settings.popup.invalid_timeout)},initMask:function(){var t=o(".awooc-form-custom-order .wpcf7-mask");t.length>0&&t.each((function(){var t=o(this),a=t.data("mask");try{t.mask(a),-1===a.indexOf("*")&&-1===a.indexOf("a")&&t.attr({inputmode:"numeric"})}catch(o){console.error("Error "+o.name+":"+o.message+"\n"+o.stack)}}))},request:function(a){var e={id:t.getProductID(a),qty:t.getQty(a),action:"awooc_ajax_product_form",nonce:awooc_scripts_ajax.nonce};t.xhr=o.ajax({url:awooc_scripts_ajax.url,data:e,type:"POST",dataType:"json",success:function(e){t.addedToPopupData(e),t.analyticData=e.data.toAnalytics,t.initContactForm(),t.initMask(),o("textarea.awooc-hidden-data").val(t.addedToMailData(e)),o(".awooc-hidden-product-id").val(t.getProductID(a)),o(".awooc-hidden-product-qty").val(t.getQty(a)),o(document.body).trigger("awooc_popup_ajax_trigger",e)},error:function(o){o.responseJSON&&console.error(o.responseJSON.data)}})},initContactForm:function(){o(".awooc-form-custom-order div.wpcf7 > form").each((function(){var t=o(this).find('input[name="_wpcf7_version"]').val();if(null!=t&&t<="5.4"){var a=o(this);wpcf7.initForm(a),wpcf7.cached&&wpcf7.refill(a)}else wpcf7.init(this)}))},popup:function(a){if(o(this).is(".disabled"))return a.preventDefault(),o(this).is(".wc-variation-is-unavailable")?window.alert(wc_add_to_cart_variation_params.i18n_unavailable_text):o(this).is(".wc-variation-selection-needed")&&window.alert(wc_add_to_cart_variation_params.i18n_make_a_selection_text),!1;o.blockUI({message:awooc_scripts_settings.template,css:awooc_scripts_settings.popup.css,overlayCSS:awooc_scripts_settings.popup.overlay,fadeIn:awooc_scripts_settings.popup.fadeIn,fadeOut:awooc_scripts_settings.popup.fadeOut,focusInput:awooc_scripts_settings.popup.focusInput,bindEvents:!1,timeout:0,allowBodyStretch:!0,centerX:!0,centerY:!0,blockMsgClass:"blockMsg blockMsgAwooc",onBlock:function(){o(document.body).trigger("awooc_popup_open_trigger"),t.request(a)},onUnblock:function(){o(document.body).trigger("awooc_popup_close_trigger")},onOverlayClick:function(){o("html").css({overflow:"initial"})}})}};t.init()}));